# Cpp-version-HAL-for-MCU-
Development of MCU general HAL library based on C++

# 为什么要做这个C++版本的单片机HAL库？ #

## - 使用C++特性显著降低运行时开销 ##
核心思路：通过编译期计算和静态多态，避免传统嵌入式开发中动态内存分配和虚函数调用带来的额外开销。

·模板元编程：
例如，针对UART波特率配置，传统C语言需在运行时计算分频值，而使用C++模板与constexpr函数，可在编译时根据波特率参数直接生成寄存器配置值，消除运行时计算开销。

·零虚函数开销：
传统面向对象设计依赖虚函数实现多态，但虚表查询会增加内存和CPU周期消耗。
改用静态多态（CRTP模式），通过模板派生类实现接口复用，完全消除虚函数开销。

·内存占用优化：
使用constexpr生成外设初始化参数表，避免动态内存分配，减少RAM占用。


## - 通用性强：跨芯片平台接口统一，仅需修改BSP层 ##
·设计原则：通过分层架构隔离硬件差异，驱动层接口与硬件无关，BSP层实现芯片适配。

·分层架构：

·BSP层：封装芯片厂商寄存器操作，例如STM32的HAL_GPIO_WritePin()和GD32的gpio_bit_write()，统一为GPIO::Set()接口。

·驱动层：提供标准外设操作接口（如UART::Send()、ADC::Read()），完全隐藏底层硬件差异。

·应用层：直接调用驱动层接口，无需关心具体芯片型号。


## - 用户接口极简：以ADC为例，三步完成数据采集 ##

·设计目标：让用户无需关注寄存器配置、时钟初始化等底层细节，仅需调用简单接口即可完成功能。

·ADC封装初始化流程举例：
用户仅需选择ADC通道，HAL库自动完成时钟使能、采样时间配置、校准等操作。
传统开发中，用户需手动配置ADC时钟、模式、通道等数十行代码，而使用该HAL库仅需1行代码即可完成采集。


# 该仓库的组成 #
1. bsp 这是芯片原厂提供的板级支持包，目前该仓库所用芯片为GD32F4系列，如果需要使用别的芯片，请更换该文件内部的BSP包，内含厂家提供的C语言驱动库，也就是我们平时单片机开发最常用的HAL库代码，子级目录hcl_gd32f3内含GD32F4的外设相关寄存器和比特位信息，用于位带操作，提高寄存器读写效率。
2. hcl 这是该库最关键的部分，是HAL库对外的接口，尽管不同的芯片BSP是不一样的，但是这个hcl文件里面的接口是统一的。
3. tests 这是hcl库的测试代码，基于unity组件，用户可自行编写TEST_CASE去验证该库的正确性。
4. 其余部分则是时钟相关、实时操作系统相关的组件，与本库无直接相关性，可参考使用。